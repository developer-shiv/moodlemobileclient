{"version":3,"sources":["./src/addons/blog/pages/entries/entries.html","./src/addons/blog/blog-lazy.module.ts","./src/addons/blog/pages/entries/entries.ts"],"names":[],"mappings":"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","file":"addons-blog-blog-lazy-module.js","sourcesContent":["export default \"<ion-header>\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\r\\n        </ion-buttons>\\r\\n        <h1>{{ title | translate }}</h1>\\r\\n        <ion-buttons slot=\\\"end\\\"></ion-buttons>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n<ion-content>\\r\\n    <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!loaded\\\" (ionRefresh)=\\\"refresh($event.target)\\\">\\r\\n        <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\r\\n    </ion-refresher>\\r\\n    <core-loading [hideUntil]=\\\"loaded\\\">\\r\\n        <ion-item *ngIf=\\\"showMyEntriesToggle\\\">\\r\\n            <ion-label>{{ 'addon.blog.showonlyyourentries' |Â translate }}</ion-label>\\r\\n            <ion-toggle [(ngModel)]=\\\"onlyMyEntries\\\" (ionChange)=\\\"onlyMyEntriesToggleChanged(onlyMyEntries)\\\"></ion-toggle>\\r\\n        </ion-item>\\r\\n        <core-empty-box *ngIf=\\\"entries && entries.length == 0\\\" icon=\\\"far-newspaper\\\"\\r\\n            [message]=\\\"'addon.blog.noentriesyet' | translate\\\">\\r\\n        </core-empty-box>\\r\\n        <ng-container *ngFor=\\\"let entry of entries\\\">\\r\\n            <ion-card *ngIf=\\\"!onlyMyEntries || entry.userid == currentUserId\\\">\\r\\n                <ion-item class=\\\"ion-text-wrap\\\">\\r\\n                    <core-user-avatar [user]=\\\"entry.user\\\" slot=\\\"start\\\" [courseId]=\\\"entry.courseid\\\"></core-user-avatar>\\r\\n                    <ion-label>\\r\\n                        <p class=\\\"item-heading\\\">\\r\\n                            <core-format-text [text]=\\\"entry.subject\\\" [contextLevel]=\\\"contextLevel\\\"\\r\\n                                [contextInstanceId]=\\\"contextInstanceId\\\">\\r\\n                            </core-format-text>\\r\\n                            <ion-note class=\\\"ion-float-end ion-padding-start ion-text-end\\\">\\r\\n                                {{ 'addon.blog.' + entry.publishTranslated! | translate}}\\r\\n                            </ion-note>\\r\\n                        </p>\\r\\n                        <p>\\r\\n                            <ion-note class=\\\"ion-float-end ion-text-end\\\">\\r\\n                                {{entry.created | coreDateDayOrTime}}\\r\\n                            </ion-note>\\r\\n                            {{entry.user && entry.user!.fullname}}\\r\\n                        </p>\\r\\n                    </ion-label>\\r\\n                </ion-item>\\r\\n                <ion-card-content>\\r\\n                    <ion-item class=\\\"ion-text-wrap\\\">\\r\\n                        <ion-label>\\r\\n                            <core-format-text [text]=\\\"entry.summary\\\" [component]=\\\"this.component\\\" [componentId]=\\\"entry.id\\\"\\r\\n                                [contextLevel]=\\\"contextLevel\\\" [contextInstanceId]=\\\"contextInstanceId\\\">\\r\\n                            </core-format-text>\\r\\n                        </ion-label>\\r\\n                    </ion-item>\\r\\n                    <ion-item class=\\\"ion-text-wrap\\\" *ngIf=\\\"tagsEnabled && entry.tags && entry.tags!.length > 0\\\">\\r\\n                        <ion-label>\\r\\n                            <div slot=\\\"start\\\">{{ 'core.tag.tags' | translate }}:</div>\\r\\n                            <core-tag-list [tags]=\\\"entry.tags\\\"></core-tag-list>\\r\\n                        </ion-label>\\r\\n                    </ion-item>\\r\\n                    <core-comments *ngIf=\\\"commentsEnabled\\\" [component]=\\\"this.component\\\" [itemId]=\\\"entry.id\\\" area=\\\"format_blog\\\"\\r\\n                        [instanceId]=\\\"entry.userid\\\" contextLevel=\\\"user\\\" [showItem]=\\\"true\\\">\\r\\n                    </core-comments>\\r\\n                    <core-file *ngFor=\\\"let file of entry.attachmentfiles\\\" [file]=\\\"file\\\" [component]=\\\"this.component\\\"\\r\\n                        [componentId]=\\\"entry.id\\\">\\r\\n                    </core-file>\\r\\n                    <ion-item *ngIf=\\\"entry.uniquehash\\\" [href]=\\\"entry.uniquehash\\\" core-link detail=\\\"true\\\">\\r\\n                        <ion-label>{{ 'addon.blog.linktooriginalentry' | translate }}</ion-label>\\r\\n                    </ion-item>\\r\\n                </ion-card-content>\\r\\n                <div class=\\\"ion-text-center ion-margin-bottom\\\" *ngIf=\\\"entry.lastmodified > entry.created\\\">\\r\\n                    <ion-note>\\r\\n                        <ion-icon name=\\\"fas-clock\\\"\\r\\n                            [attr.aria-label]=\\\"'core.lastmodified' | translate\\\"></ion-icon> {{entry.lastmodified | coreTimeAgo}}\\r\\n                    </ion-note>\\r\\n                </div>\\r\\n            </ion-card>\\r\\n        </ng-container>\\r\\n        <core-infinite-loading [enabled]=\\\"canLoadMore\\\" (action)=\\\"loadMore($event)\\\" [error]=\\\"loadMoreError\\\"></core-infinite-loading>\\r\\n    </core-loading>\\r\\n</ion-content>\\r\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Injector, NgModule } from '@angular/core';\r\nimport { RouterModule, ROUTES, Routes } from '@angular/router';\r\n\r\nimport { CoreSharedModule } from '@/core/shared.module';\r\nimport { AddonBlogEntriesPage } from './pages/entries/entries';\r\nimport { CoreCommentsComponentsModule } from '@features/comments/components/components.module';\r\n\r\nimport { CoreTagComponentsModule } from '@features/tag/components/components.module';\r\nimport { buildTabMainRoutes } from '@features/mainmenu/mainmenu-tab-routing.module';\r\nimport { AddonBlogMainMenuHandlerService } from './services/handlers/mainmenu';\r\n\r\nfunction buildRoutes(injector: Injector): Routes {\r\n    return [\r\n        ...buildTabMainRoutes(injector, {\r\n            data: {\r\n                mainMenuTabRoot: AddonBlogMainMenuHandlerService.PAGE_NAME,\r\n            },\r\n            component: AddonBlogEntriesPage,\r\n        }),\r\n    ];\r\n}\r\n\r\n@NgModule({\r\n    imports: [\r\n        CoreSharedModule,\r\n        CoreCommentsComponentsModule,\r\n        CoreTagComponentsModule,\r\n    ],\r\n    exports: [RouterModule],\r\n    providers: [\r\n        {\r\n            provide: ROUTES,\r\n            multi: true,\r\n            deps: [Injector],\r\n            useFactory: buildRoutes,\r\n        },\r\n    ],\r\n    declarations: [\r\n        AddonBlogEntriesPage,\r\n    ],\r\n})\r\nexport class AddonBlogLazyModule {}\r\n","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { ContextLevel } from '@/core/constants';\r\nimport { AddonBlog, AddonBlogFilter, AddonBlogPost, AddonBlogProvider } from '@addons/blog/services/blog';\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { CoreComments } from '@features/comments/services/comments';\r\nimport { CoreTag } from '@features/tag/services/tag';\r\nimport { CoreUser, CoreUserProfile } from '@features/user/services/user';\r\nimport { IonRefresher } from '@ionic/angular';\r\nimport { CoreNavigator } from '@services/navigator';\r\nimport { CoreSites } from '@services/sites';\r\nimport { CoreDomUtils } from '@services/utils/dom';\r\nimport { CoreTextUtils } from '@services/utils/text';\r\nimport { CoreUtils } from '@services/utils/utils';\r\n\r\n/**\r\n * Page that displays the list of blog entries.\r\n */\r\n@Component({\r\n    selector: 'page-addon-blog-entries',\r\n    templateUrl: 'entries.html',\r\n})\r\nexport class AddonBlogEntriesPage implements OnInit {\r\n\r\n    title = '';\r\n\r\n    protected filter: AddonBlogFilter = {};\r\n    protected pageLoaded = 0;\r\n    protected userPageLoaded = 0;\r\n    protected canLoadMoreEntries = false;\r\n    protected canLoadMoreUserEntries = true;\r\n    protected siteHomeId: number;\r\n\r\n    loaded = false;\r\n    canLoadMore = false;\r\n    loadMoreError = false;\r\n    entries: AddonBlogPostFormatted[] = [];\r\n    currentUserId: number;\r\n    showMyEntriesToggle = false;\r\n    onlyMyEntries = false;\r\n    component = AddonBlogProvider.COMPONENT;\r\n    commentsEnabled = false;\r\n    tagsEnabled = false;\r\n    contextLevel: ContextLevel = ContextLevel.SYSTEM;\r\n    contextInstanceId = 0;\r\n\r\n    constructor() {\r\n        this.currentUserId = CoreSites.getCurrentSiteUserId();\r\n        this.siteHomeId = CoreSites.getCurrentSiteHomeId();\r\n    }\r\n\r\n    /**\r\n     * View loaded.\r\n     */\r\n    async ngOnInit(): Promise<void> {\r\n        const userId = CoreNavigator.getRouteNumberParam('userId');\r\n        const courseId = CoreNavigator.getRouteNumberParam('courseId');\r\n        const cmId = CoreNavigator.getRouteNumberParam('cmId');\r\n        const entryId = CoreNavigator.getRouteNumberParam('entryId');\r\n        const groupId = CoreNavigator.getRouteNumberParam('groupId');\r\n        const tagId = CoreNavigator.getRouteNumberParam('tagId');\r\n\r\n        if (!userId && !courseId && !cmId && !entryId && !groupId && !tagId) {\r\n            this.title = 'addon.blog.siteblogheading';\r\n        } else {\r\n            this.title = 'addon.blog.blogentries';\r\n        }\r\n\r\n        if (userId) {\r\n            this.filter.userid = userId;\r\n        }\r\n        this.showMyEntriesToggle = !userId;\r\n\r\n        if (courseId) {\r\n            this.filter.courseid = courseId;\r\n        }\r\n\r\n        if (cmId) {\r\n            this.filter.cmid = cmId;\r\n        }\r\n\r\n        if (entryId) {\r\n            this.filter.entryid = entryId;\r\n        }\r\n\r\n        if (groupId) {\r\n            this.filter.groupid = groupId;\r\n        }\r\n\r\n        if (tagId) {\r\n            this.filter.tagid = tagId;\r\n        }\r\n\r\n        // Calculate the context level.\r\n        if (userId && !courseId && !cmId) {\r\n            this.contextLevel = ContextLevel.USER;\r\n            this.contextInstanceId = userId;\r\n        } else if (courseId && courseId != this.siteHomeId) {\r\n            this.contextLevel = ContextLevel.COURSE;\r\n            this.contextInstanceId = courseId;\r\n        } else {\r\n            this.contextLevel = ContextLevel.SYSTEM;\r\n            this.contextInstanceId = 0;\r\n        }\r\n\r\n        this.commentsEnabled = !CoreComments.areCommentsDisabledInSite();\r\n        this.tagsEnabled = CoreTag.areTagsAvailableInSite();\r\n\r\n        await this.fetchEntries();\r\n\r\n        CoreUtils.ignoreErrors(AddonBlog.logView(this.filter));\r\n    }\r\n\r\n    /**\r\n     * Fetch blog entries.\r\n     *\r\n     * @param refresh Empty events array first.\r\n     * @return Promise with the entries.\r\n     */\r\n    protected async fetchEntries(refresh: boolean = false): Promise<void> {\r\n        this.loadMoreError = false;\r\n\r\n        if (refresh) {\r\n            this.pageLoaded = 0;\r\n            this.userPageLoaded = 0;\r\n        }\r\n\r\n        const loadPage = this.onlyMyEntries ? this.userPageLoaded : this.pageLoaded;\r\n\r\n        try {\r\n            const result = await AddonBlog.getEntries(this.filter, loadPage);\r\n\r\n            const promises = result.entries.map(async (entry: AddonBlogPostFormatted) => {\r\n                switch (entry.publishstate) {\r\n                    case 'draft':\r\n                        entry.publishTranslated = 'publishtonoone';\r\n                        break;\r\n                    case 'site':\r\n                        entry.publishTranslated = 'publishtosite';\r\n                        break;\r\n                    case 'public':\r\n                        entry.publishTranslated = 'publishtoworld';\r\n                        break;\r\n                    default:\r\n                        entry.publishTranslated = 'privacy:unknown';\r\n                        break;\r\n                }\r\n\r\n                // Calculate the context. This code was inspired by calendar events, Moodle doesn't do this for blogs.\r\n                if (entry.moduleid || entry.coursemoduleid) {\r\n                    entry.contextLevel = ContextLevel.MODULE;\r\n                    entry.contextInstanceId = entry.moduleid || entry.coursemoduleid;\r\n                } else if (entry.courseid) {\r\n                    entry.contextLevel = ContextLevel.COURSE;\r\n                    entry.contextInstanceId = entry.courseid;\r\n                } else {\r\n                    entry.contextLevel = ContextLevel.USER;\r\n                    entry.contextInstanceId = entry.userid;\r\n                }\r\n\r\n                entry.summary = CoreTextUtils.instance.replacePluginfileUrls(entry.summary, entry.summaryfiles || []);\r\n\r\n                return CoreUser.getProfile(entry.userid, entry.courseid, true).then((user) => {\r\n                    entry.user = user;\r\n\r\n                    return;\r\n                }).catch(() => {\r\n                    // Ignore errors.\r\n                });\r\n            });\r\n\r\n            if (refresh) {\r\n                this.entries = result.entries;\r\n            } else {\r\n                this.entries = CoreUtils.uniqueArray(this.entries\r\n                    .concat(result.entries), 'id')\r\n                    .sort((a, b) => b.created - a.created);\r\n            }\r\n\r\n            if (this.onlyMyEntries) {\r\n                const count = this.entries.filter((entry) => entry.userid == this.currentUserId).length;\r\n                this.canLoadMoreUserEntries = result.totalentries > count;\r\n                this.canLoadMore = this.canLoadMoreUserEntries;\r\n                this.userPageLoaded++;\r\n            } else {\r\n                this.canLoadMoreEntries = result.totalentries > this.entries.length;\r\n                this.canLoadMore = this.canLoadMoreEntries;\r\n                this.pageLoaded++;\r\n            }\r\n\r\n            await Promise.all(promises);\r\n        } catch (error) {\r\n            CoreDomUtils.showErrorModalDefault(error, 'addon.blog.errorloadentries', true);\r\n            this.loadMoreError = true; // Set to prevent infinite calls with infinite-loading.\r\n        } finally {\r\n            this.loaded = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle between showing only my entries or not.\r\n     *\r\n     * @param enabled If true, filter my entries. False otherwise.\r\n     */\r\n    onlyMyEntriesToggleChanged(enabled: boolean): void {\r\n        this.canLoadMore = enabled ? this.canLoadMoreUserEntries : this.canLoadMoreEntries;\r\n\r\n        if (!enabled) {\r\n            delete this.filter.userid;\r\n\r\n            return;\r\n        }\r\n\r\n        const count = this.entries.filter((entry) => entry.userid == this.currentUserId).length;\r\n        this.userPageLoaded = Math.floor(count / AddonBlogProvider.ENTRIES_PER_PAGE);\r\n        this.filter.userid = this.currentUserId;\r\n\r\n        if (count == 0 && this.canLoadMoreUserEntries) {\r\n            // First time but no entry loaded. Try to load some.\r\n            this.loadMore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function to load more entries.\r\n     *\r\n     * @param infiniteComplete Infinite scroll complete function. Only used from core-infinite-loading.\r\n     * @return Resolved when done.\r\n     */\r\n    loadMore(infiniteComplete?: () => void): Promise<void> {\r\n        return this.fetchEntries().finally(() => {\r\n            infiniteComplete && infiniteComplete();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Refresh blog entries on PTR.\r\n     *\r\n     * @param refresher Refresher instance.\r\n     */\r\n    refresh(refresher?: IonRefresher): void {\r\n        const promises = this.entries.map((entry) =>\r\n            CoreComments.invalidateCommentsData('user', entry.userid, this.component, entry.id, 'format_blog'));\r\n\r\n        promises.push(AddonBlog.invalidateEntries(this.filter));\r\n\r\n        if (this.showMyEntriesToggle) {\r\n            this.filter['userid'] = this.currentUserId;\r\n            promises.push(AddonBlog.invalidateEntries(this.filter));\r\n\r\n            if (!this.onlyMyEntries) {\r\n                delete this.filter['userid'];\r\n            }\r\n\r\n        }\r\n\r\n        CoreUtils.allPromises(promises).finally(() => {\r\n            this.fetchEntries(true).finally(() => {\r\n                if (refresher) {\r\n                    refresher?.complete();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Blog post with some calculated data.\r\n */\r\ntype AddonBlogPostFormatted = AddonBlogPost & {\r\n    publishTranslated?: string; // Calculated in the app. Key of the string to translate the publish state of the post.\r\n    user?: CoreUserProfile; // Calculated in the app. Data of the user that wrote the post.\r\n    contextLevel?: string; // Calculated in the app. The context level of the entry.\r\n    contextInstanceId?: number; // Calculated in the app. The context instance id.\r\n};\r\n"],"sourceRoot":"webpack:///"}