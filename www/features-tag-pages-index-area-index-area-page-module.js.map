{"version":3,"sources":["./src/core/features/tag/pages/index-area/index-area.html","./src/core/features/tag/pages/index-area/index-area.page.module.ts","./src/core/features/tag/pages/index-area/index-area.page.ts"],"names":[],"mappings":"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","file":"features-tag-pages-index-area-index-area-page-module.js","sourcesContent":["export default \"<ion-header>\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\r\\n        </ion-buttons>\\r\\n        <h1>\\r\\n            {{ 'core.tag.itemstaggedwith' | translate: { $a: {tagarea: areaNameKey | translate, tag: tagName} } }}\\r\\n        </h1>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n<ion-content>\\r\\n    <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!loaded\\\" (ionRefresh)=\\\"refreshData($event.target)\\\">\\r\\n        <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\r\\n    </ion-refresher>\\r\\n    <core-loading [hideUntil]=\\\"loaded\\\">\\r\\n        <ng-container *ngIf=\\\"loaded\\\">\\r\\n            <core-dynamic-component [component]=\\\"areaComponent\\\" [data]=\\\"{items: items}\\\"></core-dynamic-component>\\r\\n        </ng-container>\\r\\n        <core-infinite-loading [enabled]=\\\"canLoadMore\\\" (action)=\\\"loadMore($event)\\\" [error]=\\\"loadMoreError\\\">\\r\\n        </core-infinite-loading>\\r\\n    </core-loading>\\r\\n</ion-content>\\r\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { CoreSharedModule } from '@/core/shared.module';\r\nimport { CoreTagIndexAreaPage } from './index-area.page';\r\n\r\nconst routes: Routes = [\r\n    {\r\n        path: '',\r\n        component: CoreTagIndexAreaPage,\r\n    },\r\n];\r\n\r\n@NgModule({\r\n    declarations: [\r\n        CoreTagIndexAreaPage,\r\n    ],\r\n    imports: [\r\n        RouterModule.forChild(routes),\r\n        CoreSharedModule,\r\n    ],\r\n    exports: [RouterModule],\r\n})\r\nexport class CoreTagIndexAreaPageModule {}\r\n","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component, OnInit, Type } from '@angular/core';\r\nimport { IonRefresher } from '@ionic/angular';\r\nimport { CoreDomUtils } from '@services/utils/dom';\r\nimport { CoreTag } from '@features/tag/services/tag';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { CoreTagAreaDelegate } from '../../services/tag-area-delegate';\r\nimport { Translate } from '@singletons';\r\nimport { CoreNavigator } from '@services/navigator';\r\n\r\n/**\r\n * Page that displays the tag index area.\r\n */\r\n@Component({\r\n    selector: 'page-core-tag-index-area',\r\n    templateUrl: 'index-area.html',\r\n})\r\nexport class CoreTagIndexAreaPage implements OnInit {\r\n\r\n    tagId = 0;\r\n    tagName = '';\r\n    collectionId = 0;\r\n    areaId = 0;\r\n    fromContextId = 0;\r\n    contextId = 0;\r\n    recursive = true;\r\n\r\n    areaNameKey = '';\r\n    loaded = false;\r\n    componentName?: string;\r\n    itemType?: string;\r\n    items: unknown[] = [];\r\n    nextPage = 0;\r\n    canLoadMore = false;\r\n    areaComponent?: Type<unknown>;\r\n    loadMoreError = false;\r\n\r\n    constructor(\r\n        protected route: ActivatedRoute,\r\n    ) { }\r\n\r\n    /**\r\n     * View loaded.\r\n     */\r\n    async ngOnInit(): Promise<void> {\r\n        this.route.queryParams.subscribe(async () => {\r\n            this.loaded = false;\r\n\r\n            this.tagId = CoreNavigator.getRouteNumberParam('tagId') || this.tagId;\r\n            this.tagName = CoreNavigator.getRouteParam('tagName') || this.tagName;\r\n            this.collectionId = CoreNavigator.getRouteNumberParam('collectionId') || this.collectionId;\r\n            this.areaId = CoreNavigator.getRouteNumberParam('areaId') || this.areaId;\r\n            this.fromContextId = CoreNavigator.getRouteNumberParam('fromContextId') || this.fromContextId;\r\n            this.contextId = CoreNavigator.getRouteNumberParam('contextId') || this.contextId;\r\n            this.recursive = CoreNavigator.getRouteBooleanParam('recursive') ?? true;\r\n\r\n            this.areaNameKey = CoreNavigator.getRouteParam('areaNameKey') || '';\r\n            // Pass the the following parameters to avoid fetching the first page.\r\n            this.componentName = CoreNavigator.getRouteParam('componentName');\r\n            this.itemType = CoreNavigator.getRouteParam('itemType');\r\n            this.items = CoreNavigator.getRouteParam<unknown[]>('items') || [];\r\n            this.nextPage = CoreNavigator.getRouteNumberParam('nextPage') || 0;\r\n            this.canLoadMore = CoreNavigator.getRouteBooleanParam('canLoadMore') || false;\r\n\r\n            try {\r\n                if (!this.componentName || !this.itemType || !this.items.length || this.nextPage == 0) {\r\n                    await this.fetchData(true);\r\n                }\r\n\r\n                this.areaComponent = await CoreTagAreaDelegate.getComponent(this.componentName!, this.itemType!);\r\n            } finally {\r\n                this.loaded = true;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch next page of the tag index area.\r\n     *\r\n     * @param refresh Whether to refresh the data or fetch a new page.\r\n     * @return Resolved when done.\r\n     */\r\n    async fetchData(refresh: boolean = false): Promise<void> {\r\n        this.loadMoreError = false;\r\n        const page = refresh ? 0 : this.nextPage;\r\n\r\n        try {\r\n            const areas = await CoreTag.getTagIndexPerArea(\r\n                this.tagId,\r\n                this.tagName,\r\n                this.collectionId,\r\n                this.areaId,\r\n                this.fromContextId,\r\n                this.contextId,\r\n                this.recursive,\r\n                page,\r\n            );\r\n            const area = areas[0];\r\n\r\n            const items = await CoreTagAreaDelegate.parseContent(area.component, area.itemtype, area.content);\r\n            if (!items || !items.length) {\r\n                // Tag area not supported.\r\n                throw Translate.instant('core.tag.errorareanotsupported');\r\n            }\r\n\r\n            if (page == 0) {\r\n                this.items = items;\r\n            } else {\r\n                this.items.push(...items);\r\n            }\r\n            this.componentName = area.component;\r\n            this.itemType = area.itemtype;\r\n            this.areaNameKey = CoreTagAreaDelegate.getDisplayNameKey(area.component, area.itemtype);\r\n            this.canLoadMore = !!area.nextpageurl;\r\n            this.nextPage = page + 1;\r\n        } catch (error) {\r\n            this.loadMoreError = true; // Set to prevent infinite calls with infinite-loading.\r\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading tag index');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load more items.\r\n     *\r\n     * @param infiniteComplete Infinite scroll complete function.\r\n     * @return Resolved when done.\r\n     */\r\n    async loadMore(infiniteComplete?: () => void): Promise<void> {\r\n        try {\r\n            await this.fetchData();\r\n        } finally {\r\n            infiniteComplete?.();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh data.\r\n     *\r\n     * @param refresher Refresher.\r\n     */\r\n    async refreshData(refresher?: IonRefresher): Promise<void> {\r\n        try {\r\n            await CoreTag.invalidateTagIndexPerArea(\r\n                this.tagId,\r\n                this.tagName,\r\n                this.collectionId,\r\n                this.areaId,\r\n                this.fromContextId,\r\n                this.contextId,\r\n                this.recursive,\r\n            );\r\n        } finally {\r\n            try {\r\n                await this.fetchData(true);\r\n            } finally {\r\n                refresher?.complete();\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}