{"version":3,"sources":["./src/core/features/login/pages/sites/sites.html","./src/core/features/login/pages/sites/sites.module.ts","./src/core/features/login/pages/sites/sites.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAe,+QAAgN,qCAAqC,47BAA47B,+BAA+B,kBAAkB,GAAG,6JAA6J,eAAe,0JAA0J,cAAc,6JAA6J,YAAY,qDAAqD,gDAAgD,oBAAoB,GAAG,utBAAutB,0BAA0B,6EAA6E,E;;;;;;;;;;;;ACA3qF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAqC;AACrC,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,iDAAiD;AACjD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEQ;AACc;AAEC;AACX;AAE7C,MAAM,MAAM,GAAW;IACnB;QACI,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,yDAAkB;KAChC;CACJ,CAAC;IAYW,wBAAwB,SAAxB,wBAAwB;CAAG;AAA3B,wBAAwB;IAVpC,8DAAQ,CAAC;QACN,OAAO,EAAE;YACL,4DAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC7B,oEAAgB;SACnB;QACD,YAAY,EAAE;YACV,yDAAkB;SACrB;QACD,OAAO,EAAE,CAAC,4DAAY,CAAC;KAC1B,CAAC;GACW,wBAAwB,CAAG;AAAH;;;;;;;;;;;;;ACrCrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAqC;AACrC,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,iDAAiD;AACjD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEkB;AACD;AACA;AAEa;AACf;AACwB;AACpB;AAC2C;AACjC;AACN;AAExD;;GAEG;IAMU,kBAAkB,SAAlB,kBAAkB;IAO3B;QALA,UAAK,GAAwB,EAAE,CAAC;QAChC,eAAU,GAAG,KAAK,CAAC;QAKf,IAAI,CAAC,MAAM,GAAG,6DAAU,CAAC,WAAW,CAAC,oBAAoB,CAAC,CAAC;IAC/D,CAAC;IAED;;;;OAIG;IACG,QAAQ;;YACV,MAAM,KAAK,GAAG,MAAM,+DAAS,CAAC,YAAY,CAAC,yDAAS,CAAC,cAAc,EAAE,EAAE,EAAyB,CAAC,CAAC;YAElG,sDAAsD;YACtD,IAAI,CAAC,KAAK,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAO,IAAI,EAAE,EAAE,CAAC;gBACrD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;gBACxD,IAAI,CAAC,KAAK,GAAG,OAAM,+DAAS,CAAC,YAAY,CAAC,4GAAqB,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAI,CAAC,CAAC;gBAE9F,OAAO,IAAI,CAAC;YAChB,CAAC,EAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAC5B,CAAC;KAAA;IAED;;OAEG;IACH,GAAG;QACC,qFAAe,CAAC,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IAC7C,CAAC;IAED;;;;;;OAMG;IACG,UAAU,CAAC,CAAQ,EAAE,IAAuB;;YAC9C,CAAC,CAAC,eAAe,EAAE,CAAC;YAEpB,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAC;YAEnC,QAAQ,GAAG,MAAM,2EAAU,CAAC,UAAU,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YAEhH,IAAI;gBACA,MAAM,gEAAY,CAAC,iBAAiB,CAAC,8BAA8B,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;aAChG;YAAC,OAAO,KAAK,EAAE;gBACZ,wBAAwB;gBACxB,OAAO;aACV;YAED,IAAI;gBACA,MAAM,yDAAS,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBAEpC,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,UAAU,EAAE,EAAE,CAAC,UAAU,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC;gBAC7E,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC1C,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;gBAExB,8CAA8C;gBAC9C,MAAM,QAAQ,GAAG,MAAM,yDAAS,CAAC,QAAQ,EAAE,CAAC;gBAE5C,IAAI,CAAC,QAAQ,EAAE;oBACX,qFAAe,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;iBAC3C;aACJ;YAAC,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sBAAsB,GAAG,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;gBAC3D,gEAAY,CAAC,qBAAqB,CAAC,KAAK,EAAE,4BAA4B,EAAE,IAAI,CAAC,CAAC;aACjF;QACL,CAAC;KAAA;IAED;;;;;OAKG;IACG,KAAK,CAAC,MAAc;;YACtB,MAAM,KAAK,GAAG,MAAM,gEAAY,CAAC,gBAAgB,EAAE,CAAC;YAEpD,IAAI;gBACA,MAAM,QAAQ,GAAG,MAAM,yDAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;gBAElD,IAAI,QAAQ,EAAE;oBACV,MAAM,iEAAa,CAAC,kBAAkB,EAAE,CAAC;oBAEzC,OAAO;iBACV;aACJ;YAAC,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,GAAG,MAAM,EAAE,KAAK,CAAC,CAAC;gBACzD,gEAAY,CAAC,qBAAqB,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;aACpE;oBAAS;gBACN,KAAK,CAAC,OAAO,EAAE,CAAC;aACnB;QACL,CAAC;KAAA;IAED;;OAEG;IACH,YAAY;QACR,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;IACvC,CAAC;IAED;;OAEG;IACH,YAAY;QACR,iEAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;IACxC,CAAC;CAEJ;;AApHY,kBAAkB;IAL9B,+DAAS,CAAC;QACP,QAAQ,EAAE,uBAAuB;QACjC,6NAAyB;QACzB,UAAU,EAAE,CAAC,sEAAc,CAAC,YAAY,CAAC;KAC5C,CAAC;GACW,kBAAkB,CAoH9B;AApH8B","file":"pages-sites-sites-module.js","sourcesContent":["export default \"<ion-header>\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\r\\n        </ion-buttons>\\r\\n\\r\\n        <h1>{{ 'core.settings.sites' | translate }}</h1>\\r\\n\\r\\n        <ion-buttons slot=\\\"end\\\">\\r\\n            <ion-button fill=\\\"clear\\\" *ngIf=\\\"sites && sites.length > 0\\\" (click)=\\\"toggleDelete()\\\"\\r\\n                [attr.aria-label]=\\\"'core.delete' | translate\\\">\\r\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"fas-pen\\\" aria-hidden=\\\"true\\\"></ion-icon>\\r\\n            </ion-button>\\r\\n            <ion-button (click)=\\\"openSettings()\\\" [attr.aria-label]=\\\"'core.settings.appsettings' | translate\\\">\\r\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"fas-cog\\\" aria-hidden=\\\"true\\\"></ion-icon>\\r\\n            </ion-button>\\r\\n        </ion-buttons>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n<ion-content>\\r\\n    <ion-list>\\r\\n        <ion-item button (click)=\\\"login(site.id)\\\" *ngFor=\\\"let site of sites\\\" detail=\\\"true\\\">\\r\\n            <ion-avatar slot=\\\"start\\\">\\r\\n                <img [src]=\\\"site.avatar\\\" core-external-content [siteId]=\\\"site.id\\\"\\r\\n                    alt=\\\"{{ 'core.pictureof' | translate:{$a: site.fullName} }}\\\" onError=\\\"this.src='assets/img/user-avatar.png'\\\">\\r\\n            </ion-avatar>\\r\\n            <ion-label>\\r\\n                <p class=\\\"item-heading\\\">{{site.fullName}}</p>\\r\\n                <p><core-format-text [text]=\\\"site.siteName\\\" clean=\\\"true\\\" [siteId]=\\\"site.id\\\"></core-format-text></p>\\r\\n                <p>{{site.siteUrl}}</p>\\r\\n            </ion-label>\\r\\n            <ion-badge slot=\\\"end\\\" *ngIf=\\\"!showDelete && site.badge\\\">\\r\\n                <span aria-hidden=\\\"true\\\">{{site.badge}}</span>\\r\\n                <span class=\\\"sr-only\\\">{{ 'core.login.sitebadgedescription' | translate:{ count: site.badge } }}</span>\\r\\n            </ion-badge>\\r\\n            <ion-button *ngIf=\\\"showDelete\\\" slot=\\\"end\\\" fill=\\\"clear\\\" color=\\\"danger\\\" (click)=\\\"deleteSite($event, site)\\\"\\r\\n                [attr.aria-label]=\\\"'core.delete' | translate\\\" [@coreSlideInOut]=\\\"'fromRight'\\\">\\r\\n                <ion-icon name=\\\"fas-trash\\\" slot=\\\"icon-only\\\" aria-hidden=\\\"true\\\"></ion-icon>\\r\\n            </ion-button>\\r\\n        </ion-item>\\r\\n    </ion-list>\\r\\n    <ion-fab slot=\\\"fixed\\\" core-fab vertical=\\\"bottom\\\" horizontal=\\\"end\\\">\\r\\n        <ion-fab-button (click)=\\\"add()\\\" [attr.aria-label]=\\\"'core.add' | translate\\\">\\r\\n            <ion-icon name=\\\"fas-plus\\\" aria-hidden=\\\"true\\\"></ion-icon>\\r\\n            <span class=\\\"sr-only\\\">{{ 'core.add' | translate }}</span>\\r\\n        </ion-fab-button>\\r\\n    </ion-fab>\\r\\n</ion-content>\\r\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { CoreSharedModule } from '@/core/shared.module';\r\nimport { CoreLoginSitesPage } from './sites';\r\n\r\nconst routes: Routes = [\r\n    {\r\n        path: '',\r\n        component: CoreLoginSitesPage,\r\n    },\r\n];\r\n\r\n@NgModule({\r\n    imports: [\r\n        RouterModule.forChild(routes),\r\n        CoreSharedModule,\r\n    ],\r\n    declarations: [\r\n        CoreLoginSitesPage,\r\n    ],\r\n    exports: [RouterModule],\r\n})\r\nexport class CoreLoginSitesPageModule {}\r\n","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { CoreDomUtils } from '@services/utils/dom';\r\nimport { CoreUtils } from '@services/utils/utils';\r\nimport { Component, OnInit } from '@angular/core';\r\n\r\nimport { CoreSiteBasicInfo, CoreSites } from '@services/sites';\r\nimport { CoreLogger } from '@singletons/logger';\r\nimport { CoreLoginHelper } from '@features/login/services/login-helper';\r\nimport { CoreNavigator } from '@services/navigator';\r\nimport { CorePushNotifications } from '@features/pushnotifications/services/pushnotifications';\r\nimport { CoreFilter } from '@features/filter/services/filter';\r\nimport { CoreAnimations } from '@components/animations';\r\n\r\n/**\r\n * Page that displays a \"splash screen\" while the app is being initialized.\r\n */\r\n@Component({\r\n    selector: 'page-core-login-sites',\r\n    templateUrl: 'sites.html',\r\n    animations: [CoreAnimations.SLIDE_IN_OUT],\r\n})\r\nexport class CoreLoginSitesPage implements OnInit {\r\n\r\n    sites: CoreSiteBasicInfo[] = [];\r\n    showDelete = false;\r\n\r\n    protected logger: CoreLogger;\r\n\r\n    constructor() {\r\n        this.logger = CoreLogger.getInstance('CoreLoginSitesPage');\r\n    }\r\n\r\n    /**\r\n     * Component being initialized.\r\n     *\r\n     * @return Promise resolved when done.\r\n     */\r\n    async ngOnInit(): Promise<void> {\r\n        const sites = await CoreUtils.ignoreErrors(CoreSites.getSortedSites(), [] as CoreSiteBasicInfo[]);\r\n\r\n        // Remove protocol from the url to show more url text.\r\n        this.sites = await Promise.all(sites.map(async (site) => {\r\n            site.siteUrl = site.siteUrl.replace(/^https?:\\/\\//, '');\r\n            site.badge = await CoreUtils.ignoreErrors(CorePushNotifications.getSiteCounter(site.id)) || 0;\r\n\r\n            return site;\r\n        }));\r\n\r\n        this.showDelete = false;\r\n    }\r\n\r\n    /**\r\n     * Go to the page to add a site.\r\n     */\r\n    add(): void {\r\n        CoreLoginHelper.goToAddSite(false, true);\r\n    }\r\n\r\n    /**\r\n     * Delete a site.\r\n     *\r\n     * @param e Click event.\r\n     * @param site Site to delete.\r\n     * @return Promise resolved when done.\r\n     */\r\n    async deleteSite(e: Event, site: CoreSiteBasicInfo): Promise<void> {\r\n        e.stopPropagation();\r\n\r\n        let siteName = site.siteName || '';\r\n\r\n        siteName = await CoreFilter.formatText(siteName, { clean: true, singleLine: true, filter: false }, [], site.id);\r\n\r\n        try {\r\n            await CoreDomUtils.showDeleteConfirm('core.login.confirmdeletesite', { sitename: siteName });\r\n        } catch (error) {\r\n            // User cancelled, stop.\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await CoreSites.deleteSite(site.id);\r\n\r\n            const index = this.sites.findIndex((listedSite) => listedSite.id == site.id);\r\n            index >= 0 && this.sites.splice(index, 1);\r\n            this.showDelete = false;\r\n\r\n            // If there are no sites left, go to add site.\r\n            const hasSites = await CoreSites.hasSites();\r\n\r\n            if (!hasSites) {\r\n                CoreLoginHelper.goToAddSite(true, true);\r\n            }\r\n        } catch (error) {\r\n            this.logger.error('Error deleting site ' + site.id, error);\r\n            CoreDomUtils.showErrorModalDefault(error, 'core.login.errordeletesite', true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Login in a site.\r\n     *\r\n     * @param siteId The site ID.\r\n     * @return Promise resolved when done.\r\n     */\r\n    async login(siteId: string): Promise<void> {\r\n        const modal = await CoreDomUtils.showModalLoading();\r\n\r\n        try {\r\n            const loggedIn = await CoreSites.loadSite(siteId);\r\n\r\n            if (loggedIn) {\r\n                await CoreNavigator.navigateToSiteHome();\r\n\r\n                return;\r\n            }\r\n        } catch (error) {\r\n            this.logger.error('Error loading site ' + siteId, error);\r\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading site.');\r\n        } finally {\r\n            modal.dismiss();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle delete.\r\n     */\r\n    toggleDelete(): void {\r\n        this.showDelete = !this.showDelete;\r\n    }\r\n\r\n    /**\r\n     * Open settings page.\r\n     */\r\n    openSettings(): void {\r\n        CoreNavigator.navigate('/settings');\r\n    }\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}